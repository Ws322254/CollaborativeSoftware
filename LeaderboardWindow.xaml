<Window x:Class="CollaborativeSoftware.LeaderboardWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Quiz Platform - Leaderboard" Height="700" Width="1000"
        WindowStartupLocation="CenterScreen"
   Background="#1a1a2e"
        Loaded="Window_Loaded">

    <Window.Resources>
    <!-- DataGrid Style to match other pages -->
     <Style TargetType="DataGrid">
        <Setter Property="Background" Value="#2d2d44"/>
          <Setter Property="Foreground" Value="White"/>
      <Setter Property="BorderBrush" Value="#3d3d54"/>
   <Setter Property="BorderThickness" Value="1"/>
     <Setter Property="RowBackground" Value="#2d2d44"/>
 <Setter Property="AlternatingRowBackground" Value="#252540"/>
<Setter Property="GridLinesVisibility" Value="Horizontal"/>
          <Setter Property="HorizontalGridLinesBrush" Value="#3d3d54"/>
   <Setter Property="VerticalGridLinesBrush" Value="#3d3d54"/>
   </Style>

        <Style TargetType="DataGridColumnHeader">
 <Setter Property="Background" Value="#1d1d34"/>
    <Setter Property="Foreground" Value="#8b3dff"/>
      <Setter Property="FontWeight" Value="Bold"/>
     <Setter Property="FontSize" Value="14"/>
        <Setter Property="Padding" Value="12,10"/>
 <Setter Property="BorderBrush" Value="#3d3d54"/>
 <Setter Property="BorderThickness" Value="0,0,0,1"/>
     </Style>

        <Style TargetType="DataGridRow">
  <Setter Property="Background" Value="#2d2d44"/>
     <Setter Property="Foreground" Value="White"/>
  <Setter Property="FontSize" Value="14"/>
   <Style.Triggers>
     <Trigger Property="IsSelected" Value="True">
 <Setter Property="Background" Value="#8b3dff"/>
    <Setter Property="Foreground" Value="White"/>
                </Trigger>
         <Trigger Property="IsMouseOver" Value="True">
     <Setter Property="Background" Value="#3d3d54"/>
</Trigger>
            </Style.Triggers>
  </Style>

        <Style TargetType="DataGridCell">
            <Setter Property="Padding" Value="12,8"/>
  <Setter Property="BorderThickness" Value="0"/>
     <Setter Property="Foreground" Value="White"/>
            <Style.Triggers>
  <Trigger Property="IsSelected" Value="True">
 <Setter Property="Background" Value="Transparent"/>
          <Setter Property="Foreground" Value="White"/>
   </Trigger>
 </Style.Triggers>
     </Style>

    <!-- Dark ComboBox Template -->
        <ControlTemplate x:Key="DarkComboBoxTemplate" TargetType="ComboBox">
  <Grid>
        <Border x:Name="Border" Background="#2d2d44" BorderBrush="#3d3d54" BorderThickness="1" CornerRadius="5"/>
 <TextBlock Margin="15,0,40,0"
         VerticalAlignment="Center"
       Foreground="White"
 FontSize="14"
  Text="{TemplateBinding Text}"/>
                <Path Data="M0,0 L5,5 L10,0" 
    Fill="#888888" 
   HorizontalAlignment="Right"
     VerticalAlignment="Center"
          Margin="0,0,15,0"/>
     <ToggleButton IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
      Background="Transparent"
      BorderThickness="0"
    Focusable="False"
   ClickMode="Press">
    <ToggleButton.Template>
           <ControlTemplate TargetType="ToggleButton">
      <Border Background="Transparent"/>
       </ControlTemplate>
        </ToggleButton.Template>
</ToggleButton>
    <Popup IsOpen="{TemplateBinding IsDropDownOpen}" 
      Placement="Bottom"
      PopupAnimation="Slide"
   AllowsTransparency="True"
      Width="{Binding ActualWidth, RelativeSource={RelativeSource TemplatedParent}}">
         <Border Background="#2d2d44" 
   BorderBrush="#3d3d54" 
         BorderThickness="1" 
      CornerRadius="5"
   Margin="0,2,0,0">
         <ScrollViewer MaxHeight="200" VerticalScrollBarVisibility="Auto">
    <ItemsPresenter/>
      </ScrollViewer>
           </Border>
           </Popup>
   </Grid>
            <ControlTemplate.Triggers>
      <Trigger Property="IsMouseOver" Value="True">
  <Setter TargetName="Border" Property="BorderBrush" Value="#8b3dff"/>
     </Trigger>
         </ControlTemplate.Triggers>
        </ControlTemplate>

     <!-- ComboBoxItem Style -->
     <Style TargetType="ComboBoxItem">
         <Setter Property="Background" Value="Transparent"/>
  <Setter Property="Foreground" Value="White"/>
   <Setter Property="Padding" Value="12,10"/>
  <Setter Property="FontSize" Value="14"/>
    <Setter Property="Cursor" Value="Hand"/>
    <Setter Property="Template">
       <Setter.Value>
  <ControlTemplate TargetType="ComboBoxItem">
        <Border x:Name="Border" 
        Background="{TemplateBinding Background}" 
 Padding="{TemplateBinding Padding}"
    CornerRadius="3">
     <ContentPresenter/>
              </Border>
  <ControlTemplate.Triggers>
  <Trigger Property="IsMouseOver" Value="True">
<Setter TargetName="Border" Property="Background" Value="#3d3d54"/>
</Trigger>
  <Trigger Property="IsSelected" Value="True">
   <Setter TargetName="Border" Property="Background" Value="#8b3dff"/>
 </Trigger>
   </ControlTemplate.Triggers>
</ControlTemplate>
        </Setter.Value>
      </Setter>
        </Style>

        <!-- ComboBox Style -->
   <Style x:Key="DarkComboBox" TargetType="ComboBox">
       <Setter Property="Background" Value="#2d2d44"/>
 <Setter Property="Foreground" Value="White"/>
      <Setter Property="BorderBrush" Value="#3d3d54"/>
   <Setter Property="BorderThickness" Value="1"/>
<Setter Property="FontSize" Value="14"/>
      <Setter Property="Template" Value="{StaticResource DarkComboBoxTemplate}"/>
  </Style>

        <!-- Button Style -->
  <Style x:Key="ActionButton" TargetType="Button">
       <Setter Property="Background" Value="#8b3dff"/>
     <Setter Property="Foreground" Value="White"/>
  <Setter Property="BorderThickness" Value="0"/>
   <Setter Property="FontSize" Value="14"/>
 <Setter Property="FontWeight" Value="SemiBold"/>
        <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="20,12"/>
         <Setter Property="Template">
    <Setter.Value>
     <ControlTemplate TargetType="Button">
   <Border Background="{TemplateBinding Background}" CornerRadius="5" Padding="{TemplateBinding Padding}">
  <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                 </Border>
  <ControlTemplate.Triggers>
       <Trigger Property="IsMouseOver" Value="True">
  <Setter Property="Background" Value="#9b4dff"/>
      </Trigger>
      </ControlTemplate.Triggers>
  </ControlTemplate>
     </Setter.Value>
      </Setter>
   </Style>
    </Window.Resources>

    <Grid Margin="30">
   <Grid.RowDefinitions>
       <RowDefinition Height="Auto"/>
    <RowDefinition Height="Auto"/>
 <RowDefinition Height="Auto"/>
       <RowDefinition Height="*"/>
     <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

   <!-- Header -->
   <StackPanel Grid.Row="0" Margin="0,0,0,25">
 <StackPanel Orientation="Horizontal">
     <TextBlock Text="??" FontSize="32" VerticalAlignment="Center" Margin="0,0,10,0"/>
     <TextBlock Text="Leaderboard" FontSize="28" FontWeight="Bold" Foreground="White"/>
 </StackPanel>
     <TextBlock Text="Top performing students across all tests" FontSize="14" Foreground="#888888" Margin="42,5,0,0"/>
        </StackPanel>

 <!-- Quiz Selection -->
        <Border Grid.Row="1" Background="#2d2d44" CornerRadius="8" Padding="20" Margin="0,0,0,20">
    <StackPanel Orientation="Horizontal">
      <TextBlock Text="Filter by Subject:" Foreground="#b0b0c8" VerticalAlignment="Center" FontSize="14" Margin="0,0,15,0"/>
      <ComboBox x:Name="QuizComboBox" Style="{StaticResource DarkComboBox}" 
      Width="300" Height="40"
    SelectionChanged="QuizComboBox_SelectionChanged"/>
  </StackPanel>
   </Border>

  <!-- Section Title -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,15">
  <TextBlock Text="??" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
      <TextBlock Text="Top Students" FontSize="18" FontWeight="Bold" Foreground="White"/>
            <TextBlock Text=" - Ranked by Total Points" FontSize="14" Foreground="#888888" VerticalAlignment="Center"/>
        </StackPanel>

  <!-- Leaderboard DataGrid -->
     <Border Grid.Row="3" Background="#2d2d44" CornerRadius="8" Padding="0" Margin="0,0,0,20">
        <DataGrid x:Name="LeaderboardDataGrid" 
       AutoGenerateColumns="False" 
 CanUserAddRows="False" 
      IsReadOnly="True"
   HeadersVisibility="Column"
 SelectionMode="Single"
    RowHeaderWidth="0">
    <DataGrid.Columns>
    <DataGridTextColumn Header="Rank" Binding="{Binding Rank}" Width="80">
 <DataGridTextColumn.ElementStyle>
       <Style TargetType="TextBlock">
   <Setter Property="VerticalAlignment" Value="Center"/>
    <Setter Property="FontWeight" Value="Bold"/>
    <Setter Property="Foreground" Value="#ffc107"/>
         </Style>
    </DataGridTextColumn.ElementStyle>
  </DataGridTextColumn>
  <DataGridTextColumn Header="Student" Binding="{Binding StudentName}" Width="*">
       <DataGridTextColumn.ElementStyle>
<Style TargetType="TextBlock">
   <Setter Property="VerticalAlignment" Value="Center"/>
       <Setter Property="Foreground" Value="White"/>
          </Style>
       </DataGridTextColumn.ElementStyle>
     </DataGridTextColumn>
   <DataGridTextColumn Header="Tests Taken" Binding="{Binding TestsTaken}" Width="120">
   <DataGridTextColumn.ElementStyle>
 <Style TargetType="TextBlock">
<Setter Property="VerticalAlignment" Value="Center"/>
    <Setter Property="Foreground" Value="#00d4ff"/>
       </Style>
          </DataGridTextColumn.ElementStyle>
           </DataGridTextColumn>
<DataGridTextColumn Header="Avg Score" Binding="{Binding AverageScore, StringFormat='{}{0:F1}%'}" Width="120">
       <DataGridTextColumn.ElementStyle>
 <Style TargetType="TextBlock">
    <Setter Property="VerticalAlignment" Value="Center"/>
          <Setter Property="Foreground" Value="#28a745"/>
     </Style>
    </DataGridTextColumn.ElementStyle>
       </DataGridTextColumn>
<DataGridTextColumn Header="Total Points" Binding="{Binding TotalPoints}" Width="120">
<DataGridTextColumn.ElementStyle>
 <Style TargetType="TextBlock">
    <Setter Property="VerticalAlignment" Value="Center"/>
<Setter Property="FontWeight" Value="Bold"/>
     <Setter Property="Foreground" Value="#8b3dff"/>
     </Style>
      </DataGridTextColumn.ElementStyle>
  </DataGridTextColumn>
     </DataGrid.Columns>
   </DataGrid>
 </Border>

  <!-- Navigation Buttons -->
   <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Left">
     <Button Content="? Back to Dashboard" Style="{StaticResource ActionButton}" 
    Click="BackButton_Click" Width="180"/>
        <Button Content="?? Refresh" Style="{StaticResource ActionButton}" 
  Click="RefreshButton_Click" Width="120" Margin="15,0,0,0" Background="#4d4d6d"/>
    </StackPanel>
 </Grid>
</Window>
